<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>せかいのこっきクイズ</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div id="title-screen" class="screen active">
    <h1>せかいのこっきクイズ</h1>
    <p>レベルをえらんでね</p>

    <div class="level-buttons">
      <button onclick="startLevel('level1')">レベル1</button>
      <button onclick="startLevel('level2')">レベル2</button>
      <button onclick="startLevel('level3')">レベル3</button>
      <button onclick="startLevel('level4')">レベル4</button>
      <button onclick="startLevel('level5')">レベル5</button>
      <button onclick="startLevel('level6')">レベル6</button>
    </div>
  </div>

  <div id="quiz-screen" class="screen">
    <div class="timer">タイマー：<span id="timer">0.0</span>秒</div>

    <h2 id="country-name"></h2>
    <img id="flag-img" alt="flag">

    <div class="hints">
      <button onclick="showHint1()">ヒント１</button>
      <div id="hint1" class="hint-text"></div>

      <button onclick="showHint2()">ヒント２</button>
      <div id="hint2" class="hint-text"></div>
    </div>

    <button id="next-btn" onclick="nextQuestion()">つぎへ</button>
  </div>

  <div id="result-screen" class="screen">
    <h2>おわり！</h2>
    <p>タイム：<span id="final-time"></span>秒</p>

    <h3>こたえ</h3>
    <div id="answer-text"></div>

    <button onclick="goHome()">タイトルへ</button>
  </div>

  <script src="data.js"></script>
  <script>
    let currentLevel = [];
    let index = 0;
    let timer = 0;
    let timerInterval;

    function startLevel(levelKey) {
      currentLevel = [...levels[levelKey]];
      shuffle(currentLevel);

      index = 0;
      timer = 0;

      document.getElementById("title-screen").classList.remove("active");
      document.getElementById("quiz-screen").classList.add("active");

      startTimer();
      loadQuestion();
    }

    function startTimer() {
      timerInterval = setInterval(() => {
        timer += 0.1;
        document.getElementById("timer").textContent = timer.toFixed(1);
      }, 100);
    }

    function stopTimer() {
      clearInterval(timerInterval);
    }

    function loadQuestion() {
      const q = currentLevel[index];
      document.getElementById("country-name").textContent = q.country;
      document.getElementById("flag-img").src = q.flag;

      document.getElementById("hint1").textContent = "";
      document.getElementById("hint2").textContent = "";
    }

    function showHint1() {
      document.getElementById("hint1").textContent = currentLevel[index].hint1;
    }

    function showHint2() {
      document.getElementById("hint2").textContent = currentLevel[index].hint2;
    }

    function nextQuestion() {
      index++;
      if (index >= currentLevel.length) {
        finishQuiz();
      } else {
        loadQuestion();
      }
    }

    function finishQuiz() {
      stopTimer();

      const lastAnswer = currentLevel[currentLevel.length - 1].answer;

      document.getElementById("quiz-screen").classList.remove("active");
      document.getElementById("result-screen").classList.add("active");

      document.getElementById("final-time").textContent = timer.toFixed(1);
      document.getElementById("answer-text").textContent = lastAnswer;
    }

    function goHome() {
      document.getElementById("result-screen").classList.remove("active");
      document.getElementById("title-screen").classList.add("active");
    }

    // Fisher–Yates シャッフル
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }
  </script>
</body>
</html>
