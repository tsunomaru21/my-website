<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>„É¨„Ç∑„Éî„É°„É¢</title>
  <style>
    body {
      font-family: "Helvetica Neue", Arial, sans-serif;
      margin: 0;
      background-color: #f8f9fa;
      color: #333;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }

    header {
      background: #0078d7;
      color: white;
      width: 100%;
      text-align: center;
      padding: 1.2rem 1rem 0.6rem;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    header h1 {
      margin: 0;
      font-size: 1.6rem;
    }

    /* ‰∫∫Ê∞ó„Çø„Ç∞„Éê„Éº */
    .tag-bar {
      display: flex;
      overflow-x: auto;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: #f0f6ff;
      border-top: 1px solid #e0e0e0;
      border-bottom: 1px solid #d0d0d0;
    }

    .tag-bar button {
      flex-shrink: 0;
      background: #e7f1ff;
      border: none;
      border-radius: 20px;
      padding: 0.3rem 0.8rem;
      color: #005bb5;
      cursor: pointer;
      transition: background 0.2s;
    }

    .tag-bar button:hover {
      background: #cde0ff;
    }

    main {
      flex: 1;
      width: 100%;
      max-width: 800px;
      text-align: center;
      padding: 1rem;
    }

    /* Ê§úÁ¥¢„Éª„ÇΩ„Éº„Éà„Éê„Éº */
    .controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    input[type="text"], select {
      padding: 0.5rem;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      width: 200px;
    }

    /* „É¨„Ç∑„Éî„Ç´„Éº„Éâ */
    .recipe-grid {
      display: grid;
      gap: 1rem;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    }

    .recipe-card {
      background: white;
      border-radius: 12px;
      padding: 1rem;
      text-align: left;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s;
      position: relative;
    }

    .recipe-card:hover {
      transform: translateY(-5px);
    }

    .recipe-card img {
      width: 100%;
      border-radius: 8px;
      object-fit: cover;
      height: 160px;
    }

    .tags {
      margin-top: 0.5rem;
    }

    .tag {
      display: inline-block;
      background: #e7f1ff;
      color: #005bb5;
      padding: 0.2rem 0.5rem;
      border-radius: 10px;
      font-size: 0.8rem;
      margin: 2px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .tag:hover {
      background: #cde0ff;
    }

    /* „ÅäÊ∞ó„Å´ÂÖ•„Çä„Éú„Çø„É≥ */
    .favorite-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 32px;
      height: 32px;
      border: none;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.9);
      color: #999;
      font-size: 18px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      transition: color 0.2s, background 0.2s, transform 0.2s;
    }

    .favorite-btn:hover {
      background: #ffeef0;
      transform: scale(1.1);
    }

    .favorite-btn.active {
      color: #e0245e;
    }

    @media (max-width: 600px) {
      .favorite-btn {
        width: 28px;
        height: 28px;
        font-size: 16px;
        top: 6px;
        right: 6px;
      }
    }

    footer {
      padding: 1rem;
      font-size: 0.9rem;
      color: #777;
    }
  </style>
</head>
<body>
  <header>
    <h1>üç≥ „É¨„Ç∑„Éî„É°„É¢</h1>
    <div class="tag-bar" id="popularTags"></div>
  </header>

  <main>
    <div class="controls">
      <input type="text" id="searchInput" placeholder="„É¨„Ç∑„ÉîÂêç„Åæ„Åü„ÅØÊùêÊñô„ÅßÊ§úÁ¥¢...">
      <select id="sortSelect">
        <option value="default">„Éá„Éï„Ç©„É´„Éà</option>
        <option value="popular">‰∫∫Ê∞óÈ†Ü</option>
        <option value="recent">ÊúÄËøëË¶ã„ÅüÈ†Ü</option>
      </select>
    </div>
    <div class="recipe-grid" id="recipeGrid"></div>
  </main>

  <footer>
    <p>&copy; 2025 My Hobby Portal</p>
  </footer>

  <script>
    const recipes = [
      {
        title: "„Ç™„É†„É©„Ç§„Çπ",
        image: "images/omurice.jpg",
        url: "https://example.com/omurice",
        tags: ["Âçµ", "„Åî„ÅØ„Çì", "„Ç±„ÉÅ„É£„ÉÉ„Éó"]
      },
      {
        title: "È∂è„ÅÆÂîêÊèö„Åí",
        image: "images/karaage.jpg",
        url: "https://example.com/karaage",
        tags: ["È∂èËÇâ", "Êèö„ÅíÁâ©", "„Åó„Çá„ÅÜ„ÇÜ"]
      },
      {
        title: "Âë≥ÂôåÊ±Å",
        image: "images/misosoup.jpg",
        url: "https://example.com/misosoup",
        tags: ["„Çπ„Éº„Éó", "Âë≥Âôå", "Ë±ÜËÖê"]
      }
    ];

    const recipeGrid = document.getElementById("recipeGrid");
    const searchInput = document.getElementById("searchInput");
    const sortSelect = document.getElementById("sortSelect");
    const popularTagsContainer = document.getElementById("popularTags");

    // --- localStorage„ÅÆ‰∫∫Ê∞ó„Çø„Ç∞ÁÆ°ÁêÜ ---
    function getPopularTags() {
      const data = localStorage.getItem("popularTags");
      return data ? JSON.parse(data) : {};
    }

    function incrementTagCount(tag) {
      const tags = getPopularTags();
      tags[tag] = (tags[tag] || 0) + 1;
      localStorage.setItem("popularTags", JSON.stringify(tags));
    }

    function renderPopularTags() {
      const tags = getPopularTags();
      const sorted = Object.entries(tags)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 10);
      popularTagsContainer.innerHTML = sorted
        .map(([tag]) => `<button>#${tag}</button>`)
        .join("");

      document.querySelectorAll(".tag-bar button").forEach(btn => {
        btn.addEventListener("click", () => {
          const t = btn.textContent.replace("#", "");
          searchInput.value = t;
          filterRecipesByQuery(t);
          incrementTagCount(t);
          renderPopularTags();
        });
      });
    }

    // --- „É¨„Ç∑„ÉîÊèèÁîª ---
    function renderRecipes(list) {
      recipeGrid.innerHTML = "";
      list.forEach(r => {
        const card = document.createElement("div");
        card.className = "recipe-card";
        card.innerHTML = `
          <button class="favorite-btn">‚ù§</button>
          <img src="${r.image}" alt="${r.title}">
          <h3>${r.title}</h3>
          <div class="tags">
            ${r.tags.map(tag => `<span class="tag">${tag}</span>`).join("")}
          </div>
        `;
        card.querySelector("img").addEventListener("click", () => {
          window.open(r.url, "_blank");
          incrementViewCount(r.title);
        });

        // „Çø„Ç∞„ÇØ„É™„ÉÉ„ÇØÊôÇ ‚Üí Ê§úÁ¥¢
        card.querySelectorAll(".tag").forEach(t => {
          t.addEventListener("click", () => {
            const tag = t.textContent;
            searchInput.value = tag;
            filterRecipesByQuery(tag);
            incrementTagCount(tag);
            renderPopularTags();
          });
        });

        // „ÅäÊ∞ó„Å´ÂÖ•„Çä
        const favBtn = card.querySelector(".favorite-btn");
        if (isFavorite(r.title)) favBtn.classList.add("active");
        favBtn.addEventListener("click", () => {
          toggleFavorite(r.title);
          favBtn.classList.toggle("active");
        });

        recipeGrid.appendChild(card);
      });
    }

    // --- „ÇΩ„Éº„Éà„Éª„Éï„Ç£„É´„Çø„ÉºÊ©üËÉΩ ---
    function filterRecipesByQuery(query) {
      const q = query.toLowerCase();
      const filtered = recipes.filter(r =>
        r.title.toLowerCase().includes(q) ||
        r.tags.some(tag => tag.toLowerCase().includes(q))
      );
      renderRecipes(filtered);
    }

    searchInput.addEventListener("input", e => {
      filterRecipesByQuery(e.target.value);
    });

    sortSelect.addEventListener("change", () => {
      const value = sortSelect.value;
      if (value === "popular") sortByViews();
      else if (value === "recent") sortByRecent();
      else renderRecipes(recipes); // „Éá„Éï„Ç©„É´„ÉàÔºà„ÅäÊ∞ó„Å´ÂÖ•„Çä„Çí‰∏äÈÉ®„Å´Ôºâ
    });

    // --- localStorage: ‰∫∫Ê∞óÈ†ÜÔºèÊúÄËøëË¶ã„ÅüÔºè„ÅäÊ∞ó„Å´ÂÖ•„Çä ---
    function incrementViewCount(title) {
      const views = JSON.parse(localStorage.getItem("views") || "{}");
      views[title] = (views[title] || 0) + 1;
      localStorage.setItem("views", JSON.stringify(views));

      const recent = JSON.parse(localStorage.getItem("recent") || []);
      const newRecent = [title, ...recent.filter(t => t !== title)].slice(0, 20);
      localStorage.setItem("recent", JSON.stringify(newRecent));
    }

    function sortByViews() {
      const views = JSON.parse(localStorage.getItem("views") || "{}");
      const sorted = [...recipes].sort((a, b) => (views[b.title] || 0) - (views[a.title] || 0));
      renderRecipes(sorted);
    }

    function sortByRecent() {
      const recent = JSON.parse(localStorage.getItem("recent") || []);
      const sorted = [...recipes].sort((a, b) => recent.indexOf(a.title) - recent.indexOf(b.title));
      renderRecipes(sorted);
    }

    // --- „ÅäÊ∞ó„Å´ÂÖ•„ÇäÊ©üËÉΩ ---
    function getFavorites() {
      return JSON.parse(localStorage.getItem("favorites") || "[]");
    }

    function isFavorite(title) {
      return getFavorites().includes(title);
    }

    function toggleFavorite(title) {
      let favs = getFavorites();
      favs = favs.includes(title) ? favs.filter(t => t !== title) : [...favs, title];
      localStorage.setItem("favorites", JSON.stringify(favs));
      if (sortSelect.value === "default") renderRecipes(getSortedDefault());
    }

    function getSortedDefault() {
      const favs = getFavorites();
      const favList = recipes.filter(r => favs.includes(r.title));
      const others = recipes.filter(r => !favs.includes(r.title));
      return [...favList, ...others];
    }

    // --- ÂàùÊúüÂåñ ---
    renderPopularTags();
    renderRecipes(getSortedDefault());
  </script>
</body>
</html>
